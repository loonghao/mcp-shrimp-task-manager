# 重試鏈式執行步驟

這個工具允許你重試鏈式任務中失敗的步驟。

## 主要功能

- **失敗重試**：重試指定的失敗步驟
- **自動檢測**：自動檢測並重試第一個失敗的步驟
- **數據連續性**：保持數據傳遞的連續性
- **記錄追蹤**：記錄重試原因和時間
- **多次重試**：支持多次重試操作

## 使用場景

- 臨時網絡問題導致的步驟失敗
- 外部服務暫時不可用
- 資源競爭導致的執行失敗
- 配置錯誤修復後的重試
- 調試過程中的手動重試

## 參數說明

### chainId (必需)
鏈式執行的唯一標識符

### stepIndex (可選)
要重試的步驟索引。如果不指定，會自動找到第一個失敗的步驟

### reason (可選)
重試原因，用於記錄和審計

## 重試機制

### 自動檢測
- 如果不指定 `stepIndex`，系統會自動找到第一個失敗或阻塞的步驟
- 檢查步驟的執行條件和依賴關係
- 驗證重試的可行性

### 數據處理
- 重試會使用原始的輸入數據和配置
- 保持與前一步驟的數據傳遞關係
- 不會影響已完成的步驟

### 條件檢查
- 只能重試失敗或阻塞的步驟
- 檢查步驟的前置條件是否滿足
- 驗證鏈式執行的整體狀態

## 返回信息

重試結果包含：
- `success`: 重試操作是否成功
- `message`: 重試結果消息
- `chainId`: 鏈式執行ID
- `result`: 重試操作詳情
  - `retryStepIndex`: 被重試的步驟索引
  - `reason`: 重試原因
  - `retriedAt`: 重試時間

## 使用示例

### 重試指定步驟
```json
{
  "chainId": "chain-12345678-abcd-efgh-ijkl-123456789012",
  "stepIndex": 2,
  "reason": "網絡問題已解決，重試步驟"
}
```

### 自動檢測重試
```json
{
  "chainId": "chain-12345678-abcd-efgh-ijkl-123456789012",
  "reason": "修復配置錯誤後重試"
}
```

## 返回示例

```json
{
  "success": true,
  "message": "步驟 2 重試已啟動",
  "chainId": "chain-12345678-abcd-efgh-ijkl-123456789012",
  "result": {
    "retryStepIndex": 2,
    "reason": "網絡問題已解決，重試步驟",
    "retriedAt": "2024-01-15T11:15:00.000Z"
  }
}
```

## 重試策略

### 重試限制
- 重試次數可能受到鏈式執行配置的限制
- 某些類型的錯誤可能不適合重試
- 系統會檢查重試的合理性

### 錯誤類型
適合重試的錯誤：
- 網絡超時或連接失敗
- 臨時資源不可用
- 外部服務暫時故障
- 可恢復的系統錯誤

不適合重試的錯誤：
- 配置錯誤
- 數據格式錯誤
- 權限問題
- 邏輯錯誤

## 注意事項

- **檢查前置條件**：重試前會檢查步驟的執行條件
- **數據一致性**：確保重試不會破壞數據的一致性
- **重試次數**：避免無限重試，注意重試次數限制
- **錯誤分析**：重試前分析失敗原因，確保問題已解決
- **監控重試**：重試後監控執行狀態，確保成功

## 錯誤處理

重試失敗的可能原因：
- 指定的鏈式執行不存在
- 步驟索引無效或步驟不存在
- 步驟狀態不允許重試
- 前置條件不滿足
- 系統資源不足

## 最佳實踐

- 重試前分析失敗原因並解決根本問題
- 提供清晰的重試原因便於追蹤
- 監控重試後的執行狀態
- 避免頻繁重試同一個步驟
- 考慮設置重試間隔時間
