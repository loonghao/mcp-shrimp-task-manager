# 取消鏈式執行

這個工具允許你取消正在執行的鏈式任務流程。

## 主要功能

- **立即停止**：立即停止正在執行的鏈式任務
- **任務取消**：取消所有未完成的步驟任務
- **結果保留**：保留已完成步驟的結果
- **原因記錄**：記錄取消原因和時間
- **資源清理**：清理執行上下文和相關資源

## 使用場景

- 發現執行錯誤需要緊急停止
- 任務執行時間過長需要中斷
- 需求變更導致任務不再需要
- 系統資源緊張需要釋放
- 調試和測試過程中的手動控制

## 參數說明

### chainId (必需)
要取消的鏈式執行的唯一標識符

### reason (可選)
取消原因，用於記錄和審計

## 返回信息

取消結果包含：
- `success`: 取消操作是否成功
- `message`: 取消結果消息
- `chainId`: 被取消的鏈式執行ID
- `result`: 取消操作詳情
  - `cancelledTasks`: 被取消的任務數量
  - `reason`: 取消原因
  - `cancelledAt`: 取消時間

## 使用示例

```json
{
  "chainId": "chain-12345678-abcd-efgh-ijkl-123456789012",
  "reason": "需求變更，任務不再需要"
}
```

## 返回示例

```json
{
  "success": true,
  "message": "鏈式執行已成功取消: chain-12345678-abcd-efgh-ijkl-123456789012",
  "chainId": "chain-12345678-abcd-efgh-ijkl-123456789012",
  "result": {
    "cancelledTasks": 3,
    "reason": "需求變更，任務不再需要",
    "cancelledAt": "2024-01-15T11:00:00.000Z"
  }
}
```

## 取消機制

### 立即效果
- 停止當前正在執行的步驟
- 標記所有未開始的步驟為已取消
- 清理執行上下文和臨時資源

### 保留內容
- 已完成步驟的結果和數據
- 執行歷史和日誌記錄
- 任務創建和更新記錄

### 狀態變更
- 未完成的任務狀態變為 `cancelled`
- 鏈式執行狀態變為 `chain_cancelled`
- 記錄取消時間和原因

## 注意事項

- **不可逆操作**：取消操作不可逆，已取消的鏈式執行無法恢復
- **正在執行的步驟**：可能需要一些時間才能完全停止
- **數據完整性**：已完成的步驟結果會被保留
- **資源釋放**：取消後會釋放相關的系統資源
- **審計記錄**：取消操作會被記錄在系統日誌中

## 錯誤處理

如果取消失敗，可能的原因：
- 指定的鏈式執行ID不存在
- 鏈式執行已經完成或已被取消
- 系統權限不足
- 內部錯誤

## 最佳實踐

- 在取消前確認鏈式執行ID正確
- 提供清晰的取消原因便於後續分析
- 取消後檢查相關資源是否正確釋放
- 必要時通知相關人員取消操作
- 考慮是否需要重新規劃替代方案
